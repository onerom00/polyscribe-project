<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ayuda · PolyScribe</title>

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Estilos globales existentes -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/nav.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme_light.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/badge.css') }}">

  <style>
    :root{
      --text:#0b1424;
      --border:#d9e4f7;
      --accent:#0b62e0;
      --card:#ffffff;
      --fs:1;
    }

    *{box-sizing:border-box}
    html,body{height:100%}

    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(180deg,#a6d6fb 0%, #9acef8 100%) fixed;
      color:var(--text);
      font-size:calc(16px * var(--fs));
    }

    /* NAV (mismo estilo que index) */
    header.ps-nav{
      background:#fff;
      border-bottom:1px solid var(--border);
    }

    .ps-nav .inner{
      max-width:1160px;
      margin:0 auto;
      padding:10px 16px;
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:space-between;
    }

    .ps-nav .brand{
      font-weight:800;
      color:#0b1424;
      text-decoration:none;
      font-size:1.05rem;
    }

    .ps-nav .links a{
      margin-right:14px;
      text-decoration:none;
      color:#13406f;
      font-weight:700;
      font-size:0.95rem;
    }

    .ps-nav .links a.active{
      color:var(--accent);
    }

    .badge-usage{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:#e8f3ff;
      color:#0b1424;
      border:1px solid #b9d9ff;
      border-radius:999px;
      padding:5px 10px;
      font-size:13px;
      font-weight:700;
    }

    .a11y-btn{
      background:#f2f6ff;
      border:1px solid #cddaf5;
      color:#0b1424;
      padding:6px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      font-size:.95rem;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }

    .container{
      max-width:980px;
      margin:28px auto 40px;
      padding:0 16px;
    }

    h1{
      margin:10px 0 16px;
      font-size:26px;
      font-weight:800;
      color:#0b1424;
    }

    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 28px rgba(15,35,52,.16);
    }

    details{
      border:1px solid #cbdcf8;
      background:#ffffff;
      border-radius:12px;
      padding:10px 12px;
      margin:10px 0;
    }
    summary{
      cursor:pointer;
      font-weight:800;
      color:#0b1424;
      outline:none;
    }
    .answer{
      margin-top:10px;
      color:#13406f;
      line-height:1.6;
      font-weight:600;
      font-size:14px;
    }
  </style>
</head>

<body data-user-id="{{ user_id|default('') }}">

  <!-- HEADER centrado -->
  <header class="ps-nav">
    <div class="inner">
      <a class="brand" href="/">PolyScribe</a>
      <nav class="links ps-nav-links">
        <a href="/" data-path="/">Transcribir</a>
        <a href="/history" data-path="/history">Historial</a>
        <a href="/pricing" data-path="/pricing">Precios</a>
        <a href="/ayuda" data-path="/ayuda">Ayuda</a>
      </nav>

      <div class="right" style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span id="usage-badge-nav" class="badge-usage">
          <span id="usage-text-nav">—/— min · libre —</span>
        </span>
        <a href="/dev-login" class="a11y-btn" id="nav-login-link">Entrar</a>
        <a href="/dev-login?signup=1" class="a11y-btn" style="background:#22c55e;border-color:#16a34a;color:#0b111d">
          Registro
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <h1>Ayuda</h1>

    <div class="card">
      <details open>
        <summary>¿Qué formatos de audio admite?</summary>
        <div class="answer">MP3, WAV, M4A, OGG, WEBM, MP4/MPEG… hasta 100 MB por archivo.</div>
      </details>

      <details>
        <summary>¿Cómo funciona el selector de idioma?</summary>
        <div class="answer">Puedes dejar “Auto” (recomendado) o seleccionar un idioma. Si eliges Auto, PolyScribe detecta el idioma automáticamente.</div>
      </details>

      <details>
        <summary>¿Puedo descargar SRT/VTT/DOCX/PDF?</summary>
        <div class="answer">Sí. Luego de transcribir, usa los botones de exportación debajo de la transcripción.</div>
      </details>

      <details>
        <summary>¿Cuántos minutos gratis tengo?</summary>
        <div class="answer">Tu saldo aparece en el badge de la parte superior. Si compras un plan, se suma automáticamente.</div>
      </details>

      <details>
        <summary>¿Cómo contacto soporte?</summary>
        <div class="answer">Usa el formulario o correo de soporte configurado en tu plataforma.</div>
      </details>
    </div>
  </div>

  <!-- Script nav + activo en menú -->
  <script src="{{ url_for('static', filename='js/nav_auth.js') }}"></script>

  <script>
    // Badge de uso (igual que otras páginas)
    (function(){
      const qs = new URLSearchParams(window.location.search);

      let USER_ID = (document.body.dataset.userId || "").trim();
      const qsUser = (qs.get("user_id") || "").trim();
      if (!USER_ID && qsUser) USER_ID = qsUser;
      if (!USER_ID) USER_ID = (localStorage.getItem("user_id") || "").trim();
      if (USER_ID) localStorage.setItem("user_id", USER_ID);
      if (!USER_ID) USER_ID = "guest";

      async function refreshBadge(){
        try{
          const r = await fetch(`/api/usage/balance?user_id=${encodeURIComponent(USER_ID)}`, {
            headers: (USER_ID !== "guest") ? {"X-User-Id": USER_ID} : {}
          });
          if(!r.ok) return;
          const j = await r.json();
          const usedMin  = (Number(j.used_seconds||0)/60);
          const allowMin = (Number(j.allowance_seconds||0)/60);
          const remain   = Math.max(0, allowMin-usedMin);
          const txt = `${usedMin.toFixed(1)}/${allowMin.toFixed(0)} min · libre ${remain.toFixed(1)} min`;
          const el = document.getElementById('usage-text-nav');
          if(el) el.textContent = txt;
        }catch{}
      }

      refreshBadge();
    })();
  </script>
</body>
</html>
