<!-- templates/pricing.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>PolyScribe ‚Äì Planes y Precios</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root{
      --bg:#e4f0ff;
      --card:#ffffff;
      --text:#0b1424;
      --muted:#4b5563;
      --border:#d9e4f7;
      --accent:#0b62e0;
      --okbg:#e2f7e9;
      --okbd:#8ad19d;
      --oktx:#125325;
      --wrnbg:#fff4e5;
      --wrnbd:#f4c08a;
      --wrntx:#7b3d00;
    }

    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      margin: 0;
      color: var(--text);
    }

    /* NAV centrado */
    .nav-wrap{background:#fff;border-bottom:1px solid var(--border);}
    .nav{
      max-width:1100px;
      margin:0 auto;
      padding:12px 16px;
      display:flex;
      justify-content:center;
      gap:10px;
      font-size:14px;
      flex-wrap:wrap;
    }
    .nav a{text-decoration:none;color:var(--accent);font-weight:700;}
    .nav .sep{color:#94a3b8;font-weight:700}
    .nav .active{color:#0b1424;font-weight:800;}

    .page{
      max-width: 1100px;
      margin: 32px auto 40px;
      padding: 0 16px;
    }
    h1{margin: 0 0 6px;font-size: 26px;}
    .subtitle{margin: 0 0 18px;font-size: 14px;color: #555;}

    .banner{
      padding: 10px 14px;
      border-radius: 12px;
      font-size: 13px;
      margin-bottom: 12px;
    }
    .banner-ok{background:var(--okbg);color:var(--oktx);border:1px solid var(--okbd);}
    .banner-warn{background:var(--wrnbg);color:var(--wrntx);border:1px solid var(--wrnbd);}
    #pay-alert{display:none;}

    .top-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      margin: 10px 0 14px;
    }
    .btn{
      background:#0b62e0;
      border:1px solid #0a59c9;
      color:#fff;
      font-weight:800;
      padding:10px 12px;
      border-radius:12px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .btn.secondary{
      background:#f2f6ff;
      color:#0b1424;
      border:1px solid #cddaf5;
      font-weight:800;
    }

    .plans-grid{
      display:grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 16px;
      margin-top: 10px;
      margin-bottom: 18px;
    }
    @media (max-width: 960px){.plans-grid{grid-template-columns: repeat(2, minmax(0, 1fr));}}
    @media (max-width: 640px){.plans-grid{grid-template-columns: minmax(0, 1fr);}}

    .plan{
      background:#ffffff;
      border-radius: 18px;
      padding: 18px 18px 20px;
      box-shadow: 0 10px 26px rgba(15, 35, 52, 0.14);
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .plan-header{margin-bottom:12px;}
    .plan-name{font-size:16px;font-weight:700;margin-bottom:4px;}
    .plan-price{font-size:22px;font-weight:800;}
    .plan-price span{font-size:14px;font-weight:500;color:#555;margin-left:6px;}
    .plan-body{font-size:14px;color:#333;}
    .plan-body ul{padding-left:18px;margin:10px 0 8px;}
    .plan-body li{margin-bottom:6px;}
    .plan-footer{margin-top:12px;}
    .plan-tag{
      display:inline-block;
      padding:2px 8px;
      font-size:11px;
      border-radius:999px;
      background:#eef2ff;
      color:#233472;
      margin-bottom:6px;
      font-weight:800;
    }

    .section-title{margin-top:18px;font-size:16px;font-weight:800;}

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:10px;
      background:white;
      border-radius:16px;
      overflow:hidden;
      font-size:13px;
      box-shadow:0 10px 26px rgba(15,35,52,0.10);
    }
    th, td{padding:9px 12px;border-bottom:1px solid #edf1fb;}
    th{text-align:left;background:#f4f6ff;font-weight:800;}
    tr:last-child td{border-bottom:none;}
    .tip{margin-top:8px;font-size:12px;color:#555;}

    /* ‚úÖ Lead box */
    .leadbox{
      margin-top:16px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      box-shadow:0 10px 26px rgba(15,35,52,0.08);
    }
    .leadbox h3{margin:0 0 6px;font-size:15px;}
    .leadbox p{margin:0 0 10px;color:#475569;font-size:13px;line-height:1.4}
    .leadform{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .leadform input{
      flex:1;
      min-width:220px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid #c6d3ec;
      font-size:14px;
      outline:none;
      background:#fff;
    }
    .leadmsg{margin-top:8px;font-size:13px;color:#0b1424;display:none}
    .leadmsg.ok{color:#125325}
    .leadmsg.err{color:#8a1c1c}

    /* ‚úÖ Modal demo */
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal{
      width:min(980px, 100%);
      background:#fff;
      border-radius:16px;
      overflow:hidden;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
      border:1px solid #d9e4f7;
    }
    .modal-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 14px;
      background:#f7fbff;
      border-bottom:1px solid #e6efff;
      font-weight:800;
    }
    .modal-close{
      background:#f2f6ff;
      border:1px solid #cddaf5;
      padding:8px 10px;
      border-radius:10px;
      cursor:pointer;
      font-weight:800;
    }
    .modal-body{
      padding:0;
      background:#000;
    }
    .modal-body iframe{
      width:100%;
      aspect-ratio:16/9;
      border:0;
      display:block;
    }

    .footer-note{margin-top:20px;font-size:12px;color:#555;line-height:1.5;}
  </style>
</head>

<body>
  <div class="nav-wrap">
    <div class="nav">
      <a href="/">PolyScribe</a>
      <span class="sep">¬∑</span>
      <a href="/transcribir">Transcribir</a>
      <span class="sep">¬∑</span>
      <a href="/history">Historial</a>
      <span class="sep">¬∑</span>
      <span class="active"><strong>Precios</strong></span>
      <span class="sep">¬∑</span>
      <a href="/ayuda">Ayuda</a>
    </div>
  </div>

  <div class="page">
    <h1>Planes y Precios</h1>
    <p class="subtitle">Empieza gratis y escala s√≥lo si necesitas m√°s minutos o funciones avanzadas.</p>

    <div class="top-actions">
      <button class="btn secondary" id="btn-demo">‚ñ∂ Ver demo</button>
      <a class="btn secondary" href="/history">üìÑ Ver historial</a>
      <a class="btn" href="/transcribir">üöÄ Ir a transcribir</a>
    </div>

    {% if paypal_enabled %}
      <div class="banner banner-ok">
        ‚úî PayPal est√° configurado. Tu saldo de minutos se activar√° autom√°ticamente despu√©s del pago.
      </div>
    {% else %}
      <div class="banner banner-warn">
        ‚ö†Ô∏è PayPal no est√° configurado por el momento. Puedes continuar usando PolyScribe con el plan Free.
      </div>
    {% endif %}

    <div id="pay-alert" class="banner banner-warn"></div>

    <div class="plans-grid">
      <!-- Free -->
      <div class="plan">
        <div>
          <div class="plan-header">
            <div class="plan-name">Free</div>
            <div class="plan-price">$0 <span>para siempre</span></div>
          </div>
          <div class="plan-body">
            <ul>
              <li>10 minutos de transcripci√≥n al mes</li>
              <li>Hasta 100&nbsp;MB por archivo</li>
              <li>Resumen autom√°tico incluido</li>
              <li>Soporte para m√∫ltiples idiomas</li>
            </ul>
          </div>
        </div>
        <div class="plan-footer">
          <small>Ideal para probar PolyScribe o usarlo de forma ocasional.</small>
        </div>
      </div>

      <!-- Starter -->
      <div class="plan">
        <div>
          <div class="plan-header">
            <span class="plan-tag">Recomendado</span>
            <div class="plan-name">Starter</div>
            <div class="plan-price">$9.99 <span>prepago</span></div>
          </div>
          <div class="plan-body">
            <ul>
              <li>60 minutos de transcripci√≥n</li>
              <li>Hasta 100&nbsp;MB por archivo</li>
              <li>Exportar SRT / VTT / DOCX / PDF</li>
              <li>Res√∫menes mejorados por IA</li>
            </ul>
          </div>
        </div>
        <div class="plan-footer">
          <div id="pp-60"></div>
          <small>Perfecto si generas contenido o tomas notas frecuentemente.</small>
        </div>
      </div>

      <!-- Pro -->
      <div class="plan">
        <div>
          <div class="plan-header">
            <div class="plan-name">Pro</div>
            <div class="plan-price">$19.99 <span>prepago</span></div>
          </div>
          <div class="plan-body">
            <ul>
              <li>300 minutos de transcripci√≥n</li>
              <li>Hasta 100&nbsp;MB por archivo</li>
              <li>Historial completo y descargas</li>
              <li>Funciones avanzadas de IA</li>
            </ul>
          </div>
        </div>
        <div class="plan-footer">
          <div id="pp-300"></div>
          <small>Para creadores, podcasters y equipos peque√±os.</small>
        </div>
      </div>

      <!-- Business -->
      <div class="plan">
        <div>
          <div class="plan-header">
            <div class="plan-name">Business</div>
            <div class="plan-price">$49.99 <span>prepago</span></div>
          </div>
          <div class="plan-body">
            <ul>
              <li>1200 minutos de transcripci√≥n</li>
              <li>Hasta 100&nbsp;MB por archivo</li>
              <li>Soporte prioritario</li>
              <li>Uso compartido dentro de tu equipo</li>
            </ul>
          </div>
        </div>
        <div class="plan-footer">
          <div id="pp-1200"></div>
          <small>Ideal para academias, empresas o agencias de contenido.</small>
        </div>
      </div>
    </div>

    <!-- ‚úÖ Lead capture -->
    <div class="leadbox">
      <h3>üì© ¬øQuieres que te avisemos de nuevas funciones y ofertas?</h3>
      <p>Deja tu email y te notificamos cuando publiquemos mejoras (sin spam).</p>

      <div class="leadform">
        <input id="lead-email" type="email" placeholder="tu@email.com" autocomplete="email">
        <input id="lead-name" type="text" placeholder="Nombre (opcional)" autocomplete="name">
        <button class="btn" id="lead-submit">Quiero enterarme</button>
      </div>
      <div class="leadmsg" id="lead-msg"></div>
    </div>

    <div>
      <div class="section-title">¬øCu√°nto rinden 100&nbsp;MB?</div>
      <table>
        <thead>
          <tr>
            <th>Formato / Bitrate</th>
            <th>Duraci√≥n aprox. por 100&nbsp;MB</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>MP3 / AAC 128 kbps</td>
            <td>‚âà 1 h 49 min</td>
          </tr>
          <tr>
            <td>MP3 / AAC 192 kbps</td>
            <td>‚âà 1 h 13 min</td>
          </tr>
          <tr>
            <td>WAV 16-bit 44.1 kHz est√©reo</td>
            <td>‚âà 9 min 54 s</td>
          </tr>
          <tr>
            <td>Opus voz 24‚Äì32 kbps</td>
            <td>‚âà entre 7‚Äì10 horas</td>
          </tr>
        </tbody>
      </table>
      <p class="tip">
        Tip: convierte tus archivos WAV/est√©reo a MP3 128&nbsp;kbps u Opus 24‚Äì32&nbsp;kbps para obtener m√°s minutos con el mismo l√≠mite de tama√±o.
      </p>
    </div>

    <p class="footer-note">
      Los planes son de tipo <strong>prepago</strong>: compras minutos y los usas cuando quieras.
      El plan Free se mantiene siempre activo como respaldo.
    </p>
  </div>

  <!-- ‚úÖ Modal demo -->
  <div class="modal-backdrop" id="demo-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Demo PolyScribe">
      <div class="modal-head">
        <div>Demo r√°pida (PolyScribe)</div>
        <button class="modal-close" id="demo-close">Cerrar</button>
      </div>
      <div class="modal-body">
        <!-- Cambia este src por tu video demo (YouTube embed o similar) -->
        <iframe id="demo-iframe"
          src="https://www.youtube.com/embed/dQw4w9WgXcQ"
          title="Demo PolyScribe"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen>
        </iframe>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/payments.js') }}"></script>

  <script>
    (function(){
      const $ = (s) => document.querySelector(s);

      // USER_ID (como en el resto)
      let USER_ID = (localStorage.getItem("user_id") || "").trim();
      if(!USER_ID) USER_ID = "guest";

      async function api(url, opts = {}){
        const h = opts.headers ? {...opts.headers} : {};
        if (USER_ID !== "guest" && !h["X-User-Id"]) h["X-User-Id"] = USER_ID;
        const res = await fetch(url, {...opts, headers: h});
        const txt = await res.text();
        let body;
        try{ body = JSON.parse(txt); }catch{ body = txt; }
        return { ok: res.ok, status: res.status, body };
      }

      // Demo modal
      const back = $("#demo-backdrop");
      const btnDemo = $("#btn-demo");
      const btnClose = $("#demo-close");
      const iframe = $("#demo-iframe");

      function openDemo(){
        if(!back) return;
        back.style.display = "flex";
        back.setAttribute("aria-hidden","false");
      }
      function closeDemo(){
        if(!back) return;
        back.style.display = "none";
        back.setAttribute("aria-hidden","true");
        // reset del video (evita que siga sonando)
        if(iframe){
          const src = iframe.getAttribute("src");
          iframe.setAttribute("src", src);
        }
      }
      if(btnDemo) btnDemo.addEventListener("click", openDemo);
      if(btnClose) btnClose.addEventListener("click", closeDemo);
      if(back) back.addEventListener("click", (e) => {
        if(e.target === back) closeDemo();
      });
      document.addEventListener("keydown", (e) => {
        if(e.key === "Escape") closeDemo();
      });

      // Lead form
      const email = $("#lead-email");
      const name = $("#lead-name");
      const submit = $("#lead-submit");
      const msg = $("#lead-msg");

      function showMsg(text, cls){
        if(!msg) return;
        msg.style.display = "block";
        msg.className = "leadmsg " + (cls || "");
        msg.textContent = text;
      }

      async function sendLead(){
        const em = (email?.value || "").trim();
        const nm = (name?.value || "").trim();

        if(!em){
          showMsg("Escribe tu email para registrarte.", "err");
          return;
        }

        submit.disabled = true;
        submit.textContent = "Enviando‚Ä¶";

        try{
          const payload = {
            email: em,
            name: nm || null,
            note: null,
            source: "pricing",
            user_id: USER_ID
          };

          const r = await api("/api/leads", {
            method:"POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(payload)
          });

          if(!r.ok){
            const err = (r.body && r.body.error) ? r.body.error : "Error";
            if(err === "EMAIL_INVALID"){
              showMsg("Email inv√°lido. Revisa el formato.", "err");
            }else{
              showMsg("No se pudo registrar ahora. Intenta de nuevo.", "err");
            }
            return;
          }

          showMsg("‚úÖ Listo, socio. Te avisaremos con novedades y ofertas.", "ok");
          if(email) email.value = "";
          if(name) name.value = "";
        }catch(e){
          showMsg("No se pudo registrar ahora. Intenta de nuevo.", "err");
        }finally{
          submit.disabled = false;
          submit.textContent = "Quiero enterarme";
        }
      }

      if(submit) submit.addEventListener("click", sendLead);
    })();
  </script>
</body>
</html>
